import { Tooltip } from "@chakra-ui/react";
import * as d3 from "d3";
import FlipNumbers from "react-flip-numbers";

interface GraphLineProps {
  width: number;
  height: number;
  data: { donation: number; additionalMatch: number }[];
  availableMatch: number;
  donationAmount: number;
}

export const BonkLine: React.FC<GraphLineProps> = ({
  width,
  height,
  data,
  availableMatch,
  donationAmount,
}) => {
  const margin = {
    top: 10,
    left: 10,
    bottom: -1,
    right: 10,
  };
  const xScale = d3
    .scalePow()
    .exponent(2)
    .domain(
      (d3.extent(data.map((d) => d.donation)) as [number, number]) ?? [0, 1]
    )
    .range([margin.left, width - margin.right]);

  const yScale = d3
    .scaleLinear()
    .domain(
      (d3.extent(data.map((d) => d.additionalMatch)) as [number, number]) ?? [
        0, 1,
      ]
    )
    .range([height - margin.bottom, margin.top]);

  const bonkLine = d3
    .line() // @ts-ignore
    .x((d) => xScale(d.donation)) // @ts-ignore
    .y((d) => yScale(d.additionalMatch));
  // @ts-ignore
  const dPath = bonkLine(data);

  const markerX = xScale(donationAmount);
  const markerY = yScale(
    data.find((d) => Math.abs(d.donation - donationAmount) < 0.1)
      ?.additionalMatch ?? 0
  ); // Get the additionalMatch value at the marker point

  const markerData = data.find(
    (d) => Math.abs(d.donation - donationAmount) < 0.1
  );

  const markerAdditionalMatch: number = markerData?.additionalMatch ?? 0;
  const markerInputValue: number = markerData?.donation ?? 0;
  return (
    <>
      <line
        x1={markerX}
        x2={markerX}
        y1={markerY}
        y2={height}
        stroke="#636666"
        strokeDasharray="2"
        strokeWidth="0.2"
      />
      <path d={dPath} fill="none" stroke="#DF9D33" strokeWidth="1.2" />
      <Tooltip
        isOpen={true}
        background={"transparent"}
        label={
          <FlipNumbers
            height={16}
            width={12}
            color="white"
            // numberStyles={{
            //   fontWeight: 'bold',
            //   fontSize: '22px',
            // }}
            play
            perspective={300}
            numbers={"$" + markerAdditionalMatch.toFixed(1)}
          />
        }
        color="#fff"
        fontWeight={"700"}
        fontSize="16px"
        placement="right"
      >
        <svg
          x={markerX - 4}
          y={markerY - 4}
          width="8"
          height="8"
          viewBox="0 0 10 10"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clipPath="url(#clip0_916_11712)">
            <path
              d="M5 10C7.76142 10 10 7.76142 10 5C10 2.23858 7.76142 0 5 0C2.23858 0 0 2.23858 0 5C0 7.76142 2.23858 10 5 10Z"
              fill="url(#paint0_radial_916_11712)"
            />
            <path
              d="M2.56637 3.53547C2.56637 3.53547 2.30784 3.86104 2.39402 5.33564C2.39402 5.33564 1.82907 6.78153 2.02058 7.51883C2.21209 8.25613 2.95896 8.21783 2.95896 8.21783C2.95896 8.21783 4.15589 9.27112 5.07512 8.34231C5.99436 7.4135 4.30909 3.81316 4.30909 3.81316L4.09843 2.56836C4.09843 2.56836 3.86863 2.75029 3.89735 3.94721C3.92608 5.14414 3.42816 4.3015 3.42816 4.3015L2.56637 3.53547Z"
              fill="#3C2D0C"
            />
            <path
              d="M2.66176 4.83711L2.34577 5.72762L2.23087 6.35002C2.23087 6.35002 1.83827 7.73845 3.45651 7.7193C3.45651 7.7193 4.72046 8.84919 5.54395 8.09274L5.76418 7.85335L6.1472 7.25968L6.77917 5.37333C6.77917 5.37333 6.57809 4.08065 5.30456 3.54443C5.30456 3.54443 5.19923 3.48698 5.00773 3.56358C5.00773 3.56358 4.48108 2.37624 4.14594 2.51987C4.14594 2.51987 3.85868 2.67307 4.10764 3.84127L3.6576 4.04235C3.6576 4.04235 3.16534 3.10905 2.70964 3.29547C2.28832 3.46783 2.66176 4.83711 2.66176 4.83711Z"
              fill="#E78C19"
            />
            <path
              d="M4.29949 3.10374L4.33779 3.62081C4.33779 3.62081 4.36652 3.91765 4.6825 3.81232C4.77181 3.78255 4.85025 3.72035 4.84199 3.61826C4.83581 3.54182 4.78243 3.4726 4.7477 3.40665C4.68268 3.28317 4.6306 3.15214 4.55498 3.03453C4.51629 2.97414 4.43664 2.83903 4.34737 2.85478C4.34737 2.85478 4.28154 2.83563 4.29949 3.10374Z"
              fill="#EFB99D"
            />
            <path
              d="M2.915 3.68507C2.92104 3.68111 3.04968 3.51813 3.31717 3.91308C3.58468 4.30807 3.55775 4.256 3.55775 4.256C3.55775 4.256 3.70138 4.41399 3.40693 4.61687C3.34276 4.66442 3.27274 4.70354 3.19861 4.73327C3.15256 4.75178 3.10335 4.7612 3.05372 4.76101C2.99783 4.75835 2.97266 4.7298 2.95886 4.6772C2.91361 4.50483 2.86263 4.33341 2.83681 4.15679C2.81733 4.02365 2.77844 3.77447 2.915 3.68507Z"
              fill="#EFB99D"
            />
            <path
              d="M6.02511 4.48012C6.02511 4.57399 5.88789 4.65008 5.71861 4.65008C5.54933 4.65008 5.41211 4.57399 5.41211 4.48012C5.41211 4.38625 5.55223 4.24805 5.72151 4.24805C5.89079 4.24805 6.02511 4.38625 6.02511 4.48012Z"
              fill="#FBFBFB"
            />
            <path
              d="M4.25753 5.21428C4.34861 5.05334 4.33908 4.8757 4.23625 4.8175C4.13341 4.7593 3.97621 4.84259 3.88513 5.00352C3.79405 5.16446 3.80358 5.3421 3.90642 5.4003C4.00925 5.4585 4.16645 5.37521 4.25753 5.21428Z"
              fill="#FBFBFB"
            />
            <path
              d="M4.69199 5.9913L5.52984 5.55562C5.52984 5.55562 6.57355 5.00982 6.8273 5.43114C7.08105 5.85246 6.8273 6.49401 6.8273 6.49401C6.8273 6.49401 6.71718 7.24567 5.95116 7.3127L5.53941 7.37015L5.01277 7.38452C5.01277 7.38452 4.16535 7.43239 3.54295 6.97278L3.34665 6.73339C3.34665 6.73339 2.94928 6.1876 3.22696 5.795C3.50465 5.40241 4.45261 6.01045 4.45261 6.01045C4.45261 6.01045 4.58188 6.07748 4.69199 5.9913Z"
              fill="#FBFBFB"
            />
            <path
              d="M6.59268 3.81818C6.70374 3.81818 6.79377 3.72815 6.79377 3.6171C6.79377 3.50604 6.70374 3.41602 6.59268 3.41602C6.48163 3.41602 6.3916 3.50604 6.3916 3.6171C6.3916 3.72815 6.48163 3.81818 6.59268 3.81818Z"
              fill="#E72D36"
            />
            <path
              d="M6.14737 3.32404C6.25843 3.32404 6.34846 3.23401 6.34846 3.12296C6.34846 3.0119 6.25843 2.92188 6.14737 2.92188C6.03632 2.92188 5.94629 3.0119 5.94629 3.12296C5.94629 3.23401 6.03632 3.32404 6.14737 3.32404Z"
              fill="#E72D36"
            />
            <path
              d="M5.43399 3.16584C5.54505 3.16584 5.63508 3.07581 5.63508 2.96475C5.63508 2.8537 5.54505 2.76367 5.43399 2.76367C5.32294 2.76367 5.23291 2.8537 5.23291 2.96475C5.23291 3.07581 5.32294 3.16584 5.43399 3.16584Z"
              fill="#E72D36"
            />
            <path
              d="M5.59217 1.53871C5.63526 2.13239 5.54956 2.66861 5.40545 2.66861C5.26134 2.66861 5.07031 2.0893 5.07031 1.53871C5.07031 1.31132 5.18953 1.27539 5.33364 1.27539C5.47774 1.27539 5.57571 1.31191 5.59217 1.53871Z"
              fill="#E72D36"
            />
            <path
              d="M6.9239 1.90977C6.70496 2.46323 6.39493 2.90903 6.2651 2.84647C6.13528 2.78391 6.21471 2.17917 6.45377 1.68322C6.5525 1.4784 6.6755 1.49779 6.80532 1.56035C6.93515 1.62291 7.00755 1.69833 6.9239 1.90977Z"
              fill="#E72D36"
            />
            <path
              d="M7.87646 2.98647C7.39451 3.33615 6.89353 3.54607 6.81758 3.42359C6.74163 3.3011 7.13339 2.83325 7.60142 2.54291C7.79472 2.423 7.88809 2.50538 7.96404 2.62787C8.03999 2.75035 8.06057 2.85288 7.87646 2.98647Z"
              fill="#E72D36"
            />
            <path
              d="M4.65211 5.40601C4.63404 5.40742 4.61649 5.40969 4.59953 5.41263C4.60164 5.41871 4.60277 5.42508 4.60286 5.4315C4.60286 5.49279 4.50758 5.54273 4.38763 5.54609C4.38678 5.55123 4.38652 5.55646 4.38687 5.56167C4.39263 5.63581 4.52071 5.68633 4.67295 5.67451C4.8252 5.66269 4.94395 5.593 4.93819 5.51886C4.93243 5.44472 4.80435 5.39419 4.65211 5.40601Z"
              fill="black"
            />
            <path
              d="M5.71168 5.14429C5.69361 5.1457 5.67607 5.14797 5.6591 5.15092C5.66121 5.15699 5.66234 5.16336 5.66243 5.16978C5.66243 5.23107 5.56715 5.28101 5.4472 5.28437C5.44635 5.28952 5.44609 5.29474 5.44644 5.29995C5.4522 5.37409 5.58028 5.42462 5.73252 5.4128C5.88477 5.40097 6.00352 5.33128 5.99776 5.25714C5.992 5.183 5.86392 5.13247 5.71168 5.14429Z"
              fill="black"
            />
            <path
              d="M6.05867 5.45551C6.05867 5.45551 5.63855 5.5776 5.66368 5.81459C5.68882 6.05158 6.19512 6.17366 6.19512 6.17366C6.19512 6.17366 6.33156 6.22752 6.41056 6.09826C6.48956 5.96899 6.60446 5.79304 6.57215 5.54169C6.57215 5.54169 6.56137 5.35497 6.05867 5.45551Z"
              fill="black"
            />
          </g>
          <defs>
            <radialGradient
              id="paint0_radial_916_11712"
              cx="0"
              cy="0"
              r="1"
              gradientUnits="userSpaceOnUse"
              gradientTransform="translate(5 5) rotate(90) scale(5)"
            >
              <stop offset="0.0356247" stopColor="#FAFF00" />
              <stop offset="1" stopColor="#E08633" />
            </radialGradient>
          </defs>
        </svg>
      </Tooltip>
    </>
  );
};
